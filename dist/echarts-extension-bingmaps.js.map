{"version":3,"file":"echarts-extension-bingmaps.js","sources":["../lib/util.js","../lib/BingMapModel.js","../lib/BingMapView.js","../lib/BingMapCoordSys.js","../lib/index.js","../index.js"],"sourcesContent":["import { version } from 'echarts'\n\nexport const ecVer = version.split('.')\n\nexport const isNewEC = ecVer[0] > 4\n\nexport const COMPONENT_TYPE = 'bingmap'\n\nexport function v2Equal(a, b) {\n  return a && b && a[0] === b[0] && a[1] === b[1]\n}\n","import { ComponentModel } from 'echarts'\n\nimport { v2Equal, isNewEC, COMPONENT_TYPE } from './util';\n\nconst BingMapModel = {\n  type: COMPONENT_TYPE,\n  setBingMap: function (bingmap) {\n    this.__bingmap = bingmap;\n  },\n  getBingMap: function () {\n    return this.__bingmap;\n  },\n  setEChartsLayer: function (layer) {\n    this.__echartsLayer = layer;\n  },\n\n  getEChartsLayer: function () {\n    return this.__echartsLayer;\n  },\n  setCenterAndZoom: function (center, zoom) {\n    this.option.viewOption.center = center;\n    this.option.viewOption.zoom = zoom;\n  },\n  centerOrZoomChanged: function (center, zoom) {\n    let option = this.option.viewOption;\n    return !(v2Equal(center, option.center) && zoom === option.zoom);\n  },\n  defaultOption: {\n    viewOption: {\n      center: [113.493471, 23.169598],\n      zoom: 5,\n    },\n    mapOption: {\n      customMapStyle: {},\n    },\n  },\n}\n\nexport default isNewEC\n  ? ComponentModel.extend(BingMapModel)\n  : BingMapModel\n","import { ComponentView } from 'echarts'\nimport { COMPONENT_TYPE, isNewEC } from './util'\n\nconst BingMapView = {\n  type: COMPONENT_TYPE,\n  init() {\n    this._isFirstRender = true\n  },\n\n  render: function (bingMapModel, ecModel, api) {\n    let rendering = true;\n    let bingmap = bingMapModel.getBingMap();\n    let viewportRoot = api.getZr().painter.getViewportRoot();\n    let coordSys = bingMapModel.coordinateSystem;\n\n    let viewChangeHandler = function (arg) {\n      if (rendering) {\n        return;\n      }\n\n      let offsetEl = viewportRoot.parentNode.parentNode.parentNode;\n      let mapOffset = [\n        -parseInt(offsetEl.style.left, 10) || 0,\n        -parseInt(offsetEl.style.top, 10) || 0,\n      ];\n      viewportRoot.style.left = mapOffset[0] + 'px';\n      viewportRoot.style.top = mapOffset[1] + 'px';\n      coordSys.setMapOffset(mapOffset);\n      bingMapModel.__mapOffset = mapOffset;\n      api.dispatchAction({\n        type: 'bingmapRoam',\n      });\n    };\n    Microsoft.Maps.Events.removeHandler(this._oldViewChangeHandler);\n    this._oldViewChangeHandler = Microsoft.Maps.Events.addHandler(\n      bingmap,\n      'viewchangeend',\n      viewChangeHandler,\n    );\n    Microsoft.Maps.Events.removeHandler(this._oldmapresize);\n    this._oldmapresize = Microsoft.Maps.Events.addHandler(bingmap, 'mapresize', viewChangeHandler);\n    this._isFirstRender = rendering = false;\n    this.__viewChangeHandler = viewChangeHandler;\n  },\n  dispose() {\n    const component = this.__model\n    if (component) {\n      component.getBingMap().dispose()\n      component.setBingMap(null)\n      component.setEChartsLayer(null)\n      if (component.coordinateSystem) {\n        component.coordinateSystem.setBingMap(null)\n        component.coordinateSystem = null\n      }\n    }\n    delete this.__viewChangeHandler\n  }\n}\n\nexport default isNewEC\n  ? ComponentView.extend(BingMapView)\n  : BingMapView\n","import { util as zrUtil, graphic, matrix } from 'echarts';\nimport { COMPONENT_TYPE } from './util';\n\nfunction BingMapCoordSys(bingmap, api) {\n  this._bingmap = bingmap;\n  this.dimensions = ['lng', 'lat'];\n  this._mapOffset = [0, 0];\n  this._api = api;\n  this._type = COMPONENT_TYPE;\n}\n\nBingMapCoordSys.prototype.dimensions = ['lng', 'lat'];\n\nBingMapCoordSys.prototype.setZoom = function (zoom) {\n  this._zoom = zoom;\n};\n\nBingMapCoordSys.prototype.setCenter = function (center) {\n  this._center = this._bingmap.tryLocationToPixel(\n    new Microsoft.Maps.Location(center[1], center[0]),\n  );\n};\n\nBingMapCoordSys.prototype.setMapOffset = function (mapOffset) {\n  this._mapOffset = mapOffset;\n};\n\nBingMapCoordSys.prototype.getBingMap = function () {\n  return this._bingmap;\n};\n\nBingMapCoordSys.prototype.dataToPoint = function (data) {\n  let lnglat = new Microsoft.Maps.Location(data[1], data[0]);\n  let px = this._bingmap.tryLocationToPixel(lnglat, Microsoft.Maps.PixelReference.control);\n  let mapOffset = this._mapOffset;\n  return [px.x - mapOffset[0], px.y - mapOffset[1]];\n};\n\nBingMapCoordSys.prototype.pointToData = function (pt) {\n  let mapOffset = this._mapOffset;\n  const ptN = this._bingmap.tryPixelToLocation(\n    {\n      x: pt[0] + mapOffset[0],\n      y: pt[1] + mapOffset[1],\n    },\n    Microsoft.Maps.PixelReference.control,\n  );\n\n  return [ptN.longitude, ptN.latitude];\n};\n\nBingMapCoordSys.prototype.getViewRect = function () {\n  let api = this._api;\n  return new graphic.BoundingRect(0, 0, api.getWidth(), api.getHeight());\n};\n\nBingMapCoordSys.prototype.getRoamTransform = function () {\n  return matrix.create();\n};\n\nBingMapCoordSys.prototype.prepareCustoms = function () {\n  let rect = this.getViewRect();\n  return {\n    coordSys: {\n      type: COMPONENT_TYPE,\n      x: rect.x,\n      y: rect.y,\n      width: rect.width,\n      height: rect.height,\n    },\n    api: {\n      coord: zrUtil.bind(this.dataToPoint, this),\n      size: zrUtil.bind(dataToCoordSize, this),\n    },\n  };\n};\n\nfunction dataToCoordSize(dataSize, dataItem) {\n  dataItem = dataItem || [0, 0];\n  return zrUtil.map(\n    [0, 1],\n    function (dimIdx) {\n      let val = dataItem[dimIdx];\n      let halfSize = dataSize[dimIdx] / 2;\n      let p1 = [];\n      let p2 = [];\n      p1[dimIdx] = val - halfSize;\n      p2[dimIdx] = val + halfSize;\n      p1[1 - dimIdx] = p2[1 - dimIdx] = dataItem[1 - dimIdx];\n      return Math.abs(this.dataToPoint(p1)[dimIdx] - this.dataToPoint(p2)[dimIdx]);\n    },\n    this,\n  );\n}\n\nBingMapCoordSys.dimensions = BingMapCoordSys.prototype.dimensions;\n\nBingMapCoordSys.create = function (ecModel, api) {\n  let bingmapCoordSys;\n  let root = api.getDom();\n\n  ecModel.eachComponent(COMPONENT_TYPE, function (bingmapModel) {\n    let painter = api.getZr().painter;\n    let viewportRoot = painter.getViewportRoot();\n\n    if (\n      typeof Microsoft === 'undefined' ||\n      typeof Microsoft.Maps === 'undefined' ||\n      typeof Microsoft.Maps.Map === 'undefined'\n    ) {\n      throw new Error('It seems that Bing Map API has not been loaded completely yet.');\n    }\n\n    if (bingmapCoordSys) {\n      throw new Error('Only one bingmap component can exist');\n    }\n\n    if (!bingmapModel.__bingmap) {\n      let bingmapRoot = root.querySelector('.ec-extension-bing-map');\n      viewportRoot.className = 'ms-composite';\n      viewportRoot.style.visibility = 'hidden';\n      if (bingmapRoot) {\n        viewportRoot.style.left = '0px';\n        viewportRoot.style.top = '0px';\n        viewportRoot.style.width = '100%';\n        viewportRoot.style.height = '100%';\n        viewportRoot.style.position = 'absolute';\n        root.removeChild(bingmapRoot);\n      }\n      bingmapRoot = document.createElement('div');\n      bingmapRoot.style.cssText = 'position:absolute;top:0;left:0;right:0;bottom:0;';\n      bingmapRoot.className = 'ec-extension-bing-map';\n      root.appendChild(bingmapRoot);\n      const bingmap = (bingmapModel.__bingmap = new Microsoft.Maps.Map(bingmapRoot));\n      let mapOption = bingmapModel.get('mapOption') || {};\n      bingmap.setOptions(mapOption);\n      bingmapRoot.querySelector('.MicrosoftMap').appendChild(viewportRoot);\n      viewportRoot.style.visibility = '';\n      painter.getViewportRootOffset = function () {\n        return {\n          offsetLeft: 0,\n          offsetTop: 0,\n        };\n      };\n    }\n\n    const bingmap = bingmapModel.__bingmap;\n    let viewOption = bingmapModel.get('viewOption');\n    let { center, zoom } = viewOption;\n    let normalizedCenter = [\n      center.lng !== undefined ? center.lng : center[0],\n      center.lat !== undefined ? center.lat : center[1],\n    ];\n\n    if (center && zoom) {\n      let bingmapCenter = bingmap.getCenter();\n      let bingmapZoom = bingmap.getZoom();\n      let centerOrZoomChanged = bingmapModel.centerOrZoomChanged(\n        [bingmapCenter.longitude, bingmapCenter.latitude],\n        bingmapZoom,\n      );\n      if (centerOrZoomChanged) {\n        let pt = new Microsoft.Maps.Location(normalizedCenter[1], normalizedCenter[0]);\n        bingmap.setView({\n          center: pt,\n          zoom: zoom,\n        });\n      }\n    }\n\n    bingmapCoordSys = new BingMapCoordSys(bingmap, api);\n    bingmapCoordSys.setMapOffset(bingmapModel.__mapOffset || [0, 0]);\n    bingmapCoordSys.setZoom(zoom);\n    bingmapCoordSys.setCenter(center);\n    bingmapModel.coordinateSystem = bingmapCoordSys;\n  });\n  ecModel.eachSeries(function (seriesModel) {\n    if (seriesModel.get('coordinateSystem') === COMPONENT_TYPE) {\n      seriesModel.coordinateSystem = bingmapCoordSys;\n    }\n  });\n};\n\nexport default BingMapCoordSys;\n","import BingMapModel from './BingMapModel';\nimport BingMapView from './BingMapView';\nimport BingMapCoordSys from './BingMapCoordSys';\nimport { isNewEC, ecVer, COMPONENT_TYPE } from './util';\n\nexport { version, name } from '../package.json';\n\n/**\n * BingMap extension installer\n * @param {EChartsExtensionRegisters} registers\n */\nexport function install(registers) {\n  // add coordinate system support for pie series for ECharts < 5.4.0\n  if (!isNewEC || (ecVer[0] == 5 && ecVer[1] < 4)) {\n    registers.registerLayout(function (ecModel) {\n      ecModel.eachSeriesByType('pie', function (seriesModel) {\n        const coordSys = seriesModel.coordinateSystem;\n        const data = seriesModel.getData();\n        const valueDim = data.mapDimension('value');\n        if (coordSys && coordSys.type === COMPONENT_TYPE) {\n          const center = seriesModel.get('center');\n          const point = coordSys.dataToPoint(center);\n          const cx = point[0];\n          const cy = point[1];\n          data.each(valueDim, function (value, idx) {\n            const layout = data.getItemLayout(idx);\n            layout.cx = cx;\n            layout.cy = cy;\n          });\n        }\n      });\n    });\n  }\n  // Model\n  isNewEC\n    ? registers.registerComponentModel(BingMapModel)\n    : registers.extendComponentModel(BingMapModel);\n  // View\n  isNewEC\n    ? registers.registerComponentView(BingMapView)\n    : registers.extendComponentView(BingMapView);\n  // Coordinate System\n  registers.registerCoordinateSystem(COMPONENT_TYPE, BingMapCoordSys);\n  // Action\n  registers.registerAction(\n    {\n      type: COMPONENT_TYPE + 'Roam',\n      event: COMPONENT_TYPE + 'Roam',\n      update: 'updateLayout',\n    },\n    function (payload, ecModel) {\n      ecModel.eachComponent('bingmap', function (bingMapModel) {\n        const bingmap = bingMapModel.getBingMap();\n        const center = bingmap.getCenter();\n        bingMapModel.setCenterAndZoom([center.longitude, center.latitude], bingmap.getZoom());\n      });\n    },\n  );\n}\n","import * as echarts from 'echarts'\nimport { install } from './lib/index'\nimport { isNewEC } from './lib/util'\n\nisNewEC ? echarts.use(install) : install(echarts)\n\nexport { name, version } from './lib/index'\n"],"names":["ecVer","version","split","isNewEC","COMPONENT_TYPE","v2Equal","a","b","BingMapModel","type","setBingMap","bingmap","__bingmap","getBingMap","setEChartsLayer","layer","__echartsLayer","getEChartsLayer","setCenterAndZoom","center","zoom","option","viewOption","centerOrZoomChanged","defaultOption","mapOption","customMapStyle","ComponentModel","extend","BingMapView","init","_isFirstRender","render","bingMapModel","ecModel","api","rendering","viewportRoot","getZr","painter","getViewportRoot","coordSys","coordinateSystem","viewChangeHandler","arg","offsetEl","parentNode","mapOffset","parseInt","style","left","top","setMapOffset","__mapOffset","dispatchAction","Microsoft","Maps","Events","removeHandler","_oldViewChangeHandler","addHandler","_oldmapresize","__viewChangeHandler","dispose","component","__model","ComponentView","BingMapCoordSys","_bingmap","dimensions","_mapOffset","_api","_type","prototype","setZoom","_zoom","setCenter","_center","tryLocationToPixel","Location","dataToPoint","data","lnglat","px","PixelReference","control","x","y","pointToData","pt","ptN","tryPixelToLocation","longitude","latitude","getViewRect","graphic","BoundingRect","getWidth","getHeight","getRoamTransform","matrix","create","prepareCustoms","rect","width","height","coord","zrUtil","bind","size","dataToCoordSize","dataSize","dataItem","map","dimIdx","val","halfSize","p1","p2","Math","abs","bingmapCoordSys","root","getDom","eachComponent","bingmapModel","Map","Error","bingmapRoot","querySelector","className","visibility","position","removeChild","document","createElement","cssText","appendChild","get","setOptions","getViewportRootOffset","offsetLeft","offsetTop","normalizedCenter","lng","undefined","lat","bingmapCenter","getCenter","bingmapZoom","getZoom","setView","eachSeries","seriesModel","install","registers","registerLayout","eachSeriesByType","getData","valueDim","mapDimension","point","cx","cy","each","value","idx","layout","getItemLayout","registerComponentModel","extendComponentModel","registerComponentView","extendComponentView","registerCoordinateSystem","registerAction","event","update","payload","echarts","use"],"mappings":"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"}